let productItems = [
   
    {
        brandName: "Nike",
        imgSrc: "img/shoes2.png",
        description: "AF2 low-top retro classic shoes",
        price:  2400,
        priceLabel: "₱ 2,400"
    },
    {
        brandName: "Adidas",
        imgSrc: "img/adidas1.AVIF",
        description: "Campus 00s Retro shoeses",
        price:  1500,
        priceLabel: "₱ 1,500"
    },
    {
        brandName: "Converse",
        imgSrc: "img/converse2.jpg",
        description: "Converse Fashion",
        price:  2300,
        priceLabel: "₱ 2,300"
    },
    {
        brandName: "Puma",
        imgSrc: "img/puma1.jpg",
        description: "Puma Fashion",
        price:  2700,
        priceLabel: "₱ 2,700"
    },
    {
        brandName: "World Balance",
        imgSrc: "img/world1.jpg",
        description: "Balance Fashion",
        price:  5500,
        priceLabel: "₱ 5,500"
    },
    {
        brandName: "Converse",
        imgSrc: "img/converse1.jpg",
        description: "Converse Fashion",
        price:  2500,
        priceLabel: "₱ 2,500"
    },
    {
        brandName: "Nike",
        imgSrc: "img/shoes6.png",
        description: "AF6 low-top retro classic shoes",
        price: 2800,
        priceLabel: "₱ 2,800"
    },
    {
        brandName: "Adidas",
        imgSrc: "img/adidas3.AVIF",
        description: "Campus 00s Retro shoeses",
        price:  1300,
        priceLabel: "₱ 1,300"
    },
    {
        brandName: "Puma",
        imgSrc: "img/puma2.jpg",
        description: "Puma Fashion",
        price:  3500,
        priceLabel: "₱ 3,500"
    },
    {
        brandName: "World Balance",
        imgSrc: "img/world2.jpg",
        description: "Balance Fashion",
        price:  3500,
        priceLabel: "₱ 3,500"
    },
    {
        brandName: "Nike",
        imgSrc: "img/shoes7.png",
        description: "AF7 low-top retro classic shoes",
        price: 2100,
        priceLabel: "₱ 2,100"
    },
    {
        brandName: "Nike",
        imgSrc: "img/shoes8.png",
        description: "AF8 low-top retro classic shoes",
        price: 2900,
        priceLabel: "₱ 2,900"
    },
    
    {
        brandName: "Nike",
        imgSrc: "img/shoes1.png",
        description: "AF1 low-top retro classic shoes",
        price:  2500,
        priceLabel: "₱ 2,500"
    },
    {
        brandName: "Adidas",
        imgSrc: "img/adidas2.AVIF",
        description: "Campus 00s Retro shoeses",
        price:  1200,
        priceLabel: "₱ 1,200"
    },
    
    {
        brandName: "Adidas",
        imgSrc: "img/adidas4.AVIF",
        description: "Campus 00s Retro shoeses",
        price:  1400,
        priceLabel: "₱ 1,400"
    },
    {
        brandName: "Adidas",
        imgSrc: "img/adidas5.jpg",
        description: "Campus 00s Retro shoeses",
        price:  1600,
        priceLabel: "₱ 1,600"
    },
    {
        brandName: "Adidas",
        imgSrc: "img/adidas6.jpg",
        description: "Campus 00s Retro shoeses",
        price: 1700,
        priceLabel: "₱ 1,700"
    },
    {
        brandName: "Adidas",
        imgSrc: "img/adidas7.jpg",
        description: "Campus 00s Retro shoeses",
        price:  1800,
        priceLabel: "₱ 1,800"
    },
    {
        brandName: "Adidas",
        imgSrc: "img/adidas8.jpg",
        description: "Campus 00s Retro shoeses",
        price:  1900,
        priceLabel: "₱ 1,900"
    },
    
    
    {
        brandName: "Converse",
        imgSrc: "img/converse3.jpg",
        description: "Converse Fashion",
        price:  2100,
        priceLabel: "₱ 2,100"
    },
    {
        brandName: "Converse",
        imgSrc: "img/converse4.jpg",
        description: "Converse Fashion",
        price:  2700,
        priceLabel: "₱ 2,700"
    },
    {
        brandName: "Converse",
        imgSrc: "img/converse5.jpg",
        description: "Converse Fashion",
        price:  3500,
        priceLabel: "₱ 3,500"
    },
    {
        brandName: "Converse",
        imgSrc: "img/converse6.jpg",
        description: "Converse Fashion",
        price:  3300,
        priceLabel: "₱ 3,300"
    },
    {
        brandName: "Converse",
        imgSrc: "img/converse7.jpg",
        description: "Converse Fashion",
        price:  2500,
        priceLabel: "₱ 2,500"
    },
    {
        brandName: "Converse",
        imgSrc: "img/converse8.jpg",
        description: "Converse Fashion",
        price:  2500,
        priceLabel: "₱ 2,500"
    },
    
    
    {
        brandName: "Puma",
        imgSrc: "img/puma3.jpg",
        description: "Puma Fashion",
        price:  3700,
        priceLabel: "₱ 3,700"
    },
    {
        brandName: "Puma",
        imgSrc: "img/puma4.jpg",
        description: "Puma Fashion",
        price:  2500,
        priceLabel: "₱ 2,500"
    },
    {
        brandName: "Puma",
        imgSrc: "img/puma5.jpg",
        description: "Puma Fashion",
        price:  2600,
        priceLabel: "₱ 2,600"
    },
    {
        brandName: "Puma",
        imgSrc: "img/puma6.jpg",
        description: "Puma Fashion",
        price:  2100,
        priceLabel: "₱ 2,100"
    },
    {
        brandName: "Puma",
        imgSrc: "img/puma7.jpg",
        description: "Puma Fashion",
        price:  2500,
        priceLabel: "₱ 2,500"
    },
    {
        brandName: "Puma",
        imgSrc: "img/puma8.jpg",
        description: "Puma Fashion",
        price:  2800,
        priceLabel: "₱ 2,800"
    },
    
    
    {
        brandName: "World Balance",
        imgSrc: "img/world3.jpg",
        description: "Balance Fashion",
        price:  2500,
        priceLabel: "₱ 2,500"
    },
    {
        brandName: "World Balance",
        imgSrc: "img/world4.jpg",
        description: "Balance Fashion",
        price:  1500,
        priceLabel: "₱ 1,500"
    },
    {
        brandName: "World Balance",
        imgSrc: "img/world5.jpg",
        description: "Balance Fashion",
        price:  2300,
        priceLabel: "₱ 2,300"
    },
    {
        brandName: "World Balance",
        imgSrc: "img/world6.jpg",
        description: "Balance Fashion",
        price:  2500,
        priceLabel: "₱ 2,500"
    },
];

let userAccounts = [
    {
        id: 1,
        firstName: "Paolo Vincent",
        lastName: "Carunia",
        email: "admin@gmail.com",
        password: "admin123456",
        userType: "Admin",
        imgSrc: ""
    },
    {
        id: 2,
        firstName: "Michael",
        lastName: "Juliano",
        email: "mjuliano@gmail.com",
        password: "user123456",
        userType: "User",
        imgSrc: ""
    }
];

let filteredBrands = [];

let selectedBrand = "";

let addedToCart = [];

loadDataToLocalStorage();

if(isUserLoggedIn()) {
    hideForms();
    showProduct();
    showProfile();
} 
else {
    hideProduct();
    showForms();
    hideProfile();
}


let sections = document.querySelectorAll('section');
let navLinks = document.querySelectorAll('header nav a');

window.addEventListener("scroll", function(){
    var nav = document.querySelector("nav");
    nav.classList.toggle("sticky", window.scrollY > 0);
});

window.onscroll = () => {
    sections.forEach(sec => {
        let top = window.scrollY;
        let offset = sec.offsetTop - 100;
        let height = sec.offsetHeight;
        let id = sec.getAttribute('id');

        if(top >= offset && top < offset + height){
            navLinks.forEach(links =>{
                links.classList.remove('active');
                document.querySelector('header nav a[href*=' + id +']').classList.add('active');
            });
        }
    });
}

const observer = new IntersectionObserver ((entries) => {
    entries.forEach((entry) => {
        console.log(entry)
        if (entry.isIntersecting){
            entry.target.classList.add('show');
        }else{
            entry.target.classList.remove('show')
        }
    });
});

const hiddenElements = document.querySelectorAll('.hidden');
hiddenElements.forEach((el) => observer.observe(el));

const modal = document.getElementById('myModal');
const openModalBtn = document.getElementById('openModalBtn');
const closeBtn = document.querySelector('.close-btn');

openModalBtn.addEventListener('click', () => {
  modal.style.display = 'block';
  if (addedToCart.length > 0){
    document.getElementById('checkout').style.display = "block";
  }else {
    document.getElementById('checkout').style.display = "none";
  }
  displayCart();
});

closeBtn.addEventListener('click', () => {
    modal.style.display = 'none';
});

function isUserLoggedIn() {
    return localStorage.getItem("currentUser");
}

function logout() {
    alert("Logout Successfully");
    localStorage.removeItem("currentUser");
    hideProduct();
    showForms();
    hideProfile();
}

function hideProfile() {
    let profile = document.getElementById("account-profile");
    profile.style.display = "none";
}

function showProfile() {
    let profile = document.getElementById("account-profile");
    let userEmail = localStorage.getItem("currentUser");
    
    let loggedinUser = userAccounts.filter( user => user.email == userEmail);

    document.getElementById("profileImage").src = loggedinUser[0].imgSrc;
    document.getElementById("user-fullname").innerHTML = loggedinUser[0].firstName + " " + loggedinUser[0].lastName;

    profile.style.display = "block";
}

function hideProduct() {
    let productsNav = document.getElementById('products-nav');
    let productsList = document.getElementById('products');
    let iconCart = document.getElementById('openModalBtn');
    productsNav.style.display = "none";
    productsList.style.display = "none";
    iconCart.style.visibility = "hidden";
}

function showProduct() {
    let productsNav = document.getElementById('products-nav');
    let productsList = document.getElementById('products');
    let iconCart = document.getElementById('openModalBtn');
    productsNav.style.display = "inline-block";
    productsList.style.display = "block";
    iconCart.style.visibility = "visible";
}

function hideForms() {
    let loginForm = document.getElementById("loginForm");
    let registerForm = document.getElementById("registerForm");
    let loginLink = document.getElementById("login-link");
    loginForm.style.display = "none";
    registerForm.style.display = "none";
    loginLink.style.display = "none";
}

function showForms() {
    let loginForm = document.getElementById("loginForm");
    let registerForm = document.getElementById("registerForm");
    let loginLink = document.getElementById("login-link");
    loginForm.style.display = "block";
    registerForm.style.display = "block";
    loginLink.style.display = "block";
}

function addProduct() {
    let filteredBrands = JSON.parse(localStorage.getItem('products'));
    filteredBrands.push({
        brandName: document.getElementById("brandName-sm").value,
        description: document.getElementById("description-sm").value,
        price: document.getElementById("price-sm").value,
        priceLabel: document.getElementById("priceLabel-sm").value,
        imgSrc: document.getElementById("image-sm").value
    });
    localStorage.setItem("products",JSON.stringify(filteredBrands));
    window.location.href = "http://127.0.0.1:5500/Shoes/index.html#products"
}

function loadCart() {
    addedToCart = JSON.parse(localStorage.getItem("cart")) || [];
    document.getElementById('countLabel').innerHTML = addedToCart.length;
}

function updateCart() {
    localStorage.setItem("cart", JSON.stringify(addedToCart));
    document.getElementById('countLabel').innerHTML = addedToCart.length;
}

function clearCart() {
    localStorage.removeItem('cart');
    localStorage.clear();
    addedToCart = [];
    document.getElementById('countLabel').innerHTML = 0;
}

function loadDataToLocalStorage() {
    loadCart();

    if(!localStorage.getItem("orders")){
        localStorage.setItem("orders", JSON.stringify([]));
    }

    if(localStorage.getItem("userAccounts")){
        let jsonData = JSON.parse(localStorage.getItem('userAccounts'));
        userAccounts = jsonData;
    }
    else {
        localStorage.setItem("userAccounts", JSON.stringify(userAccounts));
    }

    if(localStorage.getItem('products')) {
        let jsonData = JSON.parse(localStorage.getItem('products'));
        productItems = jsonData;
        filteredBrands = jsonData;
        filterBrand();
    } else {
        filteredBrands = productItems
        localStorage.setItem("products", JSON.stringify(productItems));
        filterBrand();
    }
}

function displayProducts(products){
    var product = document.getElementById("product");
    product.innerHTML = "";
    for(let x=0; x<products.length; x++) {
        product.innerHTML += '<div class="items">' +
            '<div class="product-img">' +
            '<img src='+products[x].imgSrc+'>' +
            '</div>' +
            '<h6 class="brandname">'+products[x].brandName+'</h6>' +
            '<span class="description">'+products[x].description+'</span>' +
            '<span class="price">'+products[x].priceLabel+'</span>' +
            '<button onclick="addToCart(\''+ products[x].brandName +'\', \''+ products[x].imgSrc +'\', \''+ products[x].description +'\', \''+ products[x].price +'\', \''+ products[x].priceLabel +'\')" class="cart-btn">Add to Cart</button>' +
        '</div>';
    }
}

function filterBrand(){
    let search = document.getElementById('find').value;
    selectedBrand = document.getElementById('filter').value;
    if(selectedBrand == "all"){
        selectedBrand = "";
    }
    filteredBrands = productItems.filter(function(product){
        return (selectedBrand == "" || product.brandName == selectedBrand) && (product.brandName.toLowerCase().includes(search.toLowerCase()) || product.description.toLowerCase().includes(search.toLowerCase()));
    });

    displayProducts(filteredBrands);
}

function addToCart(brandName, imgSrc, description, price, priceLabel) {
    let product = {
        quantity:1,
        brandName: brandName,
        imgSrc: imgSrc,
        description: description,
        price:  price,
        priceLabel: priceLabel,
        status: "Added",
        user: localStorage.getItem("currentUser")
    }
    addedToCart.push(product);
    updateCart();
}

function displayCart(){
    let items = document.getElementById('items-container');
    items.innerHTML = "";
    for (let x = 0; x < addedToCart.length; x++){
        items.innerHTML += '<tr>' +
            '<td class="items-cart t-data">'+
                '<img class="item-img" src="'+ addedToCart[x].imgSrc+'" width="45px">' +
                '<div class="brand-desc">' +
                    '<span class="brandName">'+addedToCart[x].brandName+'</span> <br>' + 
                    '<span class="description-cart">'+ addedToCart[x].description+'</span></td>' +
                '</div>' +
            '<td class="t-data"><h3 class="pricing">'+ addedToCart[x].priceLabel+'</h3></td>' +
            '<td class="t-data"><h3 class="quantity"><i onclick="decreaseQuantity('+addedToCart[x].quantity+', '+x+')" class="lessthan fa-solid fa-less-than"></i><span id="increaseNum'+x+'">'+addedToCart[x].quantity+'</span><i onclick="increaseQuantity('+addedToCart[x].quantity+', '+x+')" class=" greaterthan fa-solid fa-greater-than"></i></h3></td>' +
            '<td class="t-data"><h3 class="total">'+ addedToCart[x].price*addedToCart[x].quantity+'</h3></td>' +
        '</tr>';
    }
}

function decreaseQuantity(quantity, index){
    
    if(quantity-1 == 0){
        addedToCart.splice(index, 1);
        if(addedToCart.length == 0) {
            document.getElementById('checkout').style.display = "none";
        }
        updateCart();
    } else {
        addedToCart[index].quantity = quantity-1;
    }
    displayCart();
}

function increaseQuantity(quantity, index){
    console.log(quantity, index);
    addedToCart[index].quantity = quantity+1;
    displayCart();
}

function checkoutButton(){
    let checkout = document.getElementById('checkout')
    let orders = JSON.parse(localStorage.getItem("orders"));

    for(let x=0; x<addedToCart.length; x++) {
        addedToCart[x].status = "Pending";
    }
    orders = orders.concat(addedToCart);

    localStorage.setItem("orders", JSON.stringify(orders));

    if (checkout){
        alert("Thank you for checking out! Please wait for approval");
        // clearCart();
        closeBtn.click();
    }
}

function login() {
    event.preventDefault();
    const form = document.getElementById('myForm');
    const username = document.getElementById('username').value;
    const password = document.getElementById('password').value;

    let userResult = userAccounts.filter( (user) => {
        return user.email == username && user.password == password;
    });


    if (userResult.length > 0) {
        alert("Login Successfully");
        if(userResult[0].userType == "Admin") {
            localStorage.setItem("currentUser", username);
            window.location.href = "dashboard.html";
        } else {
            localStorage.setItem("currentUser", username);
            window.location.href = "index.html";
            showProduct();
            hideForms();
            showProfile();
        }
    } else {
        alert("Incorrect username or password");
    }
}

function register(){
    const form = document.getElementById('myForm');
    const username = document.getElementById('username').value;
    const password = document.getElementById('password').value;

    if (username && password){
        alert("You're now registered");
    }
    else {
        alert("Required input fields");
    }
}



let profile = document.querySelector(".profile");
let menu = document.querySelector(".menu");


profile.addEventListener("click", ()=>{
    menu.classList.toggle("active")
})             